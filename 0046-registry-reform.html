<!DOCTYPE HTML>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>0046-registry-reform - </title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <base href="">

        <link rel="stylesheet" href="book.css">
        <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro:500" rel="stylesheet" type="text/css">

        <link rel="shortcut icon" href="favicon.png">

        <!-- Font Awesome -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">

        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme -->
        

        

        <!-- Fetch Clipboard.js from CDN but have a local fallback -->
        <script src="https://cdn.jsdelivr.net/clipboard.js/1.6.1/clipboard.min.js"></script>
        <script>
            if (typeof Clipboard == 'undefined') {
                document.write(unescape("%3Cscript src='clipboard.min.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch JQuery from CDN but have a local fallback -->
        <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script>
            if (typeof jQuery == 'undefined') {
                document.write(unescape("%3Cscript src='jquery.js'%3E%3C/script%3E"));
            }
        </script>

        <!-- Fetch store.js from local - TODO add CDN when 2.x.x is available on cdnjs -->
        <script src="store.js"></script>

        <!-- Custom JS script -->
        

    </head>
    <body class="light">
        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme = store.get('mdbook-theme');
            if (theme === null || theme === undefined) { theme = 'light'; }
            $('body').removeClass().addClass(theme);
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var sidebar = store.get('mdbook-sidebar');
            if (sidebar === "hidden") { $("html").addClass("sidebar-hidden") }
            else if (sidebar === "visible") { $("html").addClass("sidebar-visible") }
        </script>

        <div id="sidebar" class="sidebar">
            <ul class="chapter"><li class="affix"><a href="introduction.html">Introduction</a></li><li><a href="0001-transform-attribute-meta-parameter.html"><strong>1.</strong> 0001-transform-attribute-meta-parameter</a></li><li><a href="0003-block-params.html"><strong>2.</strong> 0003-block-params</a></li><li><a href="0003-cli-ember-doctor.html"><strong>3.</strong> 0003-cli-ember-doctor</a></li><li><a href="0010-engines.html"><strong>4.</strong> 0010-engines</a></li><li><a href="0011-improved-cp-syntax.html"><strong>5.</strong> 0011-improved-cp-syntax</a></li><li><a href="0012-help-json-output.html"><strong>6.</strong> 0012-help-json-output</a></li><li><a href="0015-the-road-to-ember-2-0.html"><strong>7.</strong> 0015-the-road-to-ember-2-0</a></li><li><a href="0020-sri-default.html"><strong>8.</strong> 0020-sri-default</a></li><li><a href="0023-command-line-completion.html"><strong>9.</strong> 0023-command-line-completion</a></li><li><a href="0024-bound-attributes.html"><strong>10.</strong> 0024-bound-attributes</a></li><li><a href="0028-app-import-output-file.html"><strong>11.</strong> 0028-app-import-output-file</a></li><li><a href="0029-addon-black-and-whitelist-for-apps.html"><strong>12.</strong> 0029-addon-black-and-whitelist-for-apps</a></li><li><a href="0045-internet-explorer.html"><strong>13.</strong> 0045-internet-explorer</a></li><li><a href="0046-cli-improved-release-process.html"><strong>14.</strong> 0046-cli-improved-release-process</a></li><li><a href="0046-registry-reform.html" class="active"><strong>15.</strong> 0046-registry-reform</a></li><li><a href="0050-cli-production-code-stripping.html"><strong>16.</strong> 0050-cli-production-code-stripping</a></li><li><a href="0050-improved-actions.html"><strong>17.</strong> 0050-improved-actions</a></li><li><a href="0053-helpers.html"><strong>18.</strong> 0053-helpers</a></li><li><a href="0055-anonymous-amd.html"><strong>19.</strong> 0055-anonymous-amd</a></li><li><a href="0056-improved-release-cycle.html"><strong>20.</strong> 0056-improved-release-cycle</a></li><li><a href="0057-ember-data-reference-unification.html"><strong>21.</strong> 0057-ember-data-reference-unification</a></li><li><a href="0058-helper-listing.html"><strong>22.</strong> 0058-helper-listing</a></li><li><a href="0061-ember-data-background-fetch.html"><strong>23.</strong> 0061-ember-data-background-fetch</a></li><li><a href="0064-contextual-component-lookup.html"><strong>24.</strong> 0064-contextual-component-lookup</a></li><li><a href="0065-deprecation-warning-handlers.html"><strong>25.</strong> 0065-deprecation-warning-handlers</a></li><li><a href="0080-serve-file-api.html"><strong>26.</strong> 0080-serve-file-api</a></li><li><a href="0086-firefox-in-ci.html"><strong>27.</strong> 0086-firefox-in-ci</a></li><li><a href="0090-addon-tree-caching.html"><strong>28.</strong> 0090-addon-tree-caching</a></li><li><a href="0091-cli-addon-instrumentation-experimental-hooks.html"><strong>29.</strong> 0091-cli-addon-instrumentation-experimental-hooks</a></li><li><a href="0091-weakmap.html"><strong>30.</strong> 0091-weakmap</a></li><li><a href="0092-blueprint-remove-old-files.html"><strong>31.</strong> 0092-blueprint-remove-old-files</a></li><li><a href="0095-cli-standardise-targets.html"><strong>32.</strong> 0095-cli-standardise-targets</a></li><li><a href="0095-router-service.html"><strong>33.</strong> 0095-router-service</a></li><li><a href="0096-enable-yarn-usage.html"><strong>34.</strong> 0096-enable-yarn-usage</a></li><li><a href="0101-ember-data-friendly-errors.html"><strong>35.</strong> 0101-ember-data-friendly-errors</a></li><li><a href="0105-addons-optionalDependencies.html"><strong>36.</strong> 0105-addons-optionalDependencies</a></li><li><a href="0108-add-custom-transform.html"><strong>37.</strong> 0108-add-custom-transform</a></li><li><a href="0110-packaging.html"><strong>38.</strong> 0110-packaging</a></li><li><a href="0114-add-template-lint-addon.html"><strong>39.</strong> 0114-add-template-lint-addon</a></li><li><a href="0116-qunit-dom.html"><strong>40.</strong> 0116-qunit-dom</a></li><li><a href="0120-cli-guides.html"><strong>41.</strong> 0120-cli-guides</a></li><li><a href="0120-route-serializers.html"><strong>42.</strong> 0120-route-serializers</a></li><li><a href="0121-remove-ember-cli-eslint.html"><strong>43.</strong> 0121-remove-ember-cli-eslint</a></li><li><a href="0136-contains-to-includes.html"><strong>44.</strong> 0136-contains-to-includes</a></li><li><a href="0139-isHtmlSafe.html"><strong>45.</strong> 0139-isHtmlSafe</a></li><li><a href="0143-module-unification.html"><strong>46.</strong> 0143-module-unification</a></li><li><a href="0150-factory-for.html"><strong>47.</strong> 0150-factory-for</a></li><li><a href="0176-javascript-module-api.html"><strong>48.</strong> 0176-javascript-module-api</a></li><li><a href="0178-deprecate-ember-k.html"><strong>49.</strong> 0178-deprecate-ember-k</a></li><li><a href="0181-deprecate-ember-data-initializers.html"><strong>50.</strong> 0181-deprecate-ember-data-initializers</a></li><li><a href="0186-track-unique-history-location-state.html"><strong>51.</strong> 0186-track-unique-history-location-state</a></li><li><a href="0191-deprecate-component-lifecycle-hook-args.html"><strong>52.</strong> 0191-deprecate-component-lifecycle-hook-args</a></li><li><a href="0194-deprecate-custom-event-manager.html"><strong>53.</strong> 0194-deprecate-custom-event-manager</a></li><li><a href="0213-custom-components.html"><strong>54.</strong> 0213-custom-components</a></li><li><a href="0225-ember-engines-mount-params.html"><strong>55.</strong> 0225-ember-engines-mount-params</a></li><li><a href="0226-named-blocks.html"><strong>56.</strong> 0226-named-blocks</a></li><li><a href="0229-deprecate-testing-restricted-resolver.html"><strong>57.</strong> 0229-deprecate-testing-restricted-resolver</a></li><li><a href="0232-simplify-qunit-testing-api.html"><strong>58.</strong> 0232-simplify-qunit-testing-api</a></li><li><a href="0236-deprecation-ember-string.html"><strong>59.</strong> 0236-deprecation-ember-string</a></li><li><a href="0237-deprecation-ember-map.html"><strong>60.</strong> 0237-deprecation-ember-map</a></li><li><a href="0240-es-classes.html"><strong>61.</strong> 0240-es-classes</a></li><li><a href="0252-browser-support-changes.html"><strong>62.</strong> 0252-browser-support-changes</a></li><li><a href="0268-acceptance-testing-refactor.html"><strong>63.</strong> 0268-acceptance-testing-refactor</a></li><li><a href="0272-deprecation-native-function-prototype-extensions.html"><strong>64.</strong> 0272-deprecation-native-function-prototype-extensions</a></li><li><a href="0276-named-args.html"><strong>65.</strong> 0276-named-args</a></li><li><a href="0278-template-only-components.html"><strong>66.</strong> 0278-template-only-components</a></li><li><a href="0280-remove-application-wrapper.html"><strong>67.</strong> 0280-remove-application-wrapper</a></li><li><a href="0281-es5-getters.html"><strong>68.</strong> 0281-es5-getters</a></li><li><a href="0286-block-let-template-helper.html"><strong>69.</strong> 0286-block-let-template-helper</a></li><li><a href="0287-promote-in-element-to-public-api.html"><strong>70.</strong> 0287-promote-in-element-to-public-api</a></li><li><a href="0293-record-data.html"><strong>71.</strong> 0293-record-data</a></li><li><a href="0294-optional-jquery.html"><strong>72.</strong> 0294-optional-jquery</a></li><li><a href="0297-deprecate-ember-logger.html"><strong>73.</strong> 0297-deprecate-ember-logger</a></li><li><a href="0300-rfc-process-update.html"><strong>74.</strong> 0300-rfc-process-update</a></li><li><a href="0308-deprecate-property-lookup-fallback.html"><strong>75.</strong> 0308-deprecate-property-lookup-fallback</a></li><li><a href="0311-angle-bracket-invocation.html"><strong>76.</strong> 0311-angle-bracket-invocation</a></li><li><a href="0318-array-helper.html"><strong>77.</strong> 0318-array-helper</a></li><li><a href="0322-deprecate-copy-copyable.html"><strong>78.</strong> 0322-deprecate-copy-copyable</a></li><li><a href="0324-deprecate-component-isvisible.html"><strong>79.</strong> 0324-deprecate-component-isvisible</a></li><li><a href="0326-ember-data-filter-deprecation.html"><strong>80.</strong> 0326-ember-data-filter-deprecation</a></li><li><a href="0329-deprecated-ember-evented-in-ember-data.html"><strong>81.</strong> 0329-deprecated-ember-evented-in-ember-data</a></li><li><a href="0331-deprecate-globals-resolver.html"><strong>82.</strong> 0331-deprecate-globals-resolver</a></li><li><a href="0332-ember-data-record-links-and-meta.html"><strong>83.</strong> 0332-ember-data-record-links-and-meta</a></li><li><a href="0335-deprecate-send-action.html"><strong>84.</strong> 0335-deprecate-send-action</a></li><li><a href="0337-native-class-constructor-update.html"><strong>85.</strong> 0337-native-class-constructor-update</a></li><li><a href="0340-deprecate-ember-merge.html"><strong>86.</strong> 0340-deprecate-ember-merge</a></li><li><a href="0345-discord.html"><strong>87.</strong> 0345-discord</a></li><li><a href="0364-roadmap-2018.html"><strong>88.</strong> 0364-roadmap-2018</a></li><li><a href="0369-deprecate-computed-clobberability.html"><strong>89.</strong> 0369-deprecate-computed-clobberability</a></li><li><a href="0370-deprecate-computed-volatile.html"><strong>90.</strong> 0370-deprecate-computed-volatile</a></li><li><a href="0372-ember-data-model-factory-for.html"><strong>91.</strong> 0372-ember-data-model-factory-for</a></li><li><a href="0373-Element-Modifier-Managers.html"><strong>92.</strong> 0373-Element-Modifier-Managers</a></li><li><a href="0375-deprecate-computed-property-modifier.html"><strong>93.</strong> 0375-deprecate-computed-property-modifier</a></li><li><a href="0386-remove-jquery.html"><strong>94.</strong> 0386-remove-jquery</a></li><li><a href="0391-router-helpers.html"><strong>95.</strong> 0391-router-helpers</a></li><li><a href="0392-deprecate-component-manager-string-lookup.html"><strong>96.</strong> 0392-deprecate-component-manager-string-lookup</a></li><li><a href="0395-ember-data-packages.html"><strong>97.</strong> 0395-ember-data-packages</a></li><li><a href="0398-RouteInfo-Metadata.html"><strong>98.</strong> 0398-RouteInfo-Metadata</a></li><li><a href="0408-decorators.html"><strong>99.</strong> 0408-decorators</a></li><li><a href="0410-tracked-properties.html"><strong>100.</strong> 0410-tracked-properties</a></li><li><a href="0415-render-element-modifiers.html"><strong>101.</strong> 0415-render-element-modifiers</a></li><li><a href="0416-glimmer-components.html"><strong>102.</strong> 0416-glimmer-components</a></li><li><a href="0418-deprecate-route-render-methods.html"><strong>103.</strong> 0418-deprecate-route-render-methods</a></li><li><a href="0421-deprecate-application-controller-props.html"><strong>104.</strong> 0421-deprecate-application-controller-props</a></li><li><a href="0431-guides-restructure.html"><strong>105.</strong> 0431-guides-restructure</a></li><li><a href="0432-contextual-helpers.html"><strong>106.</strong> 0432-contextual-helpers</a></li><li><a href="0435-modifier-splattributes.html"><strong>107.</strong> 0435-modifier-splattributes</a></li><li><a href="0440-decorator-support.html"><strong>108.</strong> 0440-decorator-support</a></li><li><a href="0445-deprecate-with.html"><strong>109.</strong> 0445-deprecate-with</a></li><li><a href="0446-contribution-guides.html"><strong>110.</strong> 0446-contribution-guides</a></li><li><a href="0449-deprecate-partials.html"><strong>111.</strong> 0449-deprecate-partials</a></li><li><a href="0457-nested-lookups.html"><strong>112.</strong> 0457-nested-lookups</a></li><li><a href="0459-angle-bracket-built-in-components.html"><strong>113.</strong> 0459-angle-bracket-built-in-components</a></li></ul>
        </div>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page" tabindex="-1">
                <div id="menu-bar" class="menu-bar">
                    <div class="left-buttons">
                        <i id="sidebar-toggle" class="fa fa-bars"></i>
                        <i id="theme-toggle" class="fa fa-paint-brush"></i>
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html">
                            <i id="print-button" class="fa fa-print" title="Print this book"></i>
                        </a>
                    </div>
                </div>

                <div id="content" class="content">
                    <ul>
<li>Start Date: 2015-04-09</li>
<li>RFC PR: https://github.com/emberjs/rfcs/pull/46</li>
<li>Ember Issue: https://github.com/emberjs/ember.js/pull/11440</li>
</ul>
<a class="header" href="0046-registry-reform.html#summary" id="summary"><h1>Summary</h1></a>
<p>Fully encapsulate and privatize the <code>Container</code> and <code>Registry</code> classes by
exposing a select subset of public methods on <code>Application</code> and
<code>ApplicationInstance</code>.</p>
<a class="header" href="0046-registry-reform.html#motivation" id="motivation"><h1>Motivation</h1></a>
<p>The <code>Container</code> and <code>Registry</code> classes currently lead a confusing life of
semi-private exclusion within Ember applications. They are undocumented
publicly but not fully private either, as knowledge of their particulars is
required for developing both initializers and unit tests. This situation has
become untenable as the new <code>Registry</code> class has been extracted from
<code>Container</code>, and the complexity of their usage has grown across
<code>Application</code> and <code>ApplicationInstance</code> classes.</p>
<p>We can bring sanity to this situation by continuing the work started at the
<code>Application</code> level to expose methods such as <code>register</code> and <code>inject</code> from the
internally maintained <code>Registry</code>.</p>
<p>Furthermore, once <code>Container</code> and <code>Registry</code> are fully private, their
architecture and documentation can be cleaned up. For instance, a
<code>Container</code> can freely reference its associated <code>Registry</code> as <code>registry</code>
rather than <code>_registry</code>, as it can be assumed that only framework developers
will reference this property.</p>
<a class="header" href="0046-registry-reform.html#detailed-design" id="detailed-design"><h1>Detailed design</h1></a>
<p><code>Application</code> will expose the following methods from its internally maintained
registry:</p>
<ul>
<li><code>register</code></li>
<li><code>inject</code></li>
<li><code>registerOptions</code> - mapped to <code>Registry#options</code></li>
<li><code>registerOptionsForType</code> - mapped to <code>Registry#optionsForType</code></li>
</ul>
<p><code>ApplicationInstance</code> will also expose the the same methods. However, these
methods will be exposed from its own internally maintained registry, which
has the associated <code>Application</code>'s registry configured as a &quot;fall back&quot;. No
direct path will be provided from the <code>ApplicationInstance</code> to the
<code>Application</code>'s registry.</p>
<p><code>ApplicationInstance</code> will also expose the following methods from its
internally maintained container:</p>
<ul>
<li><code>lookup</code></li>
<li><code>lookupFactory</code></li>
</ul>
<p><code>ApplicationInstance</code> will cease exposing <code>container</code>, <code>registry</code>, and
<code>applicationRegistry</code> publicly.</p>
<p><code>Application</code> initializers will receive a single argument to <code>initialize</code>:
<code>application</code>.</p>
<p>Likewise, <code>ApplicationInstance</code> initializers will receive a single argument
to <code>initialize</code>: <code>applicationInstance</code>.</p>
<p><code>Container</code> and <code>Registry</code> will be made fully private and documented as
such. Each <code>Container</code> will freely reference its associated <code>Registry</code> as
<code>registry</code> rather than <code>_registry</code>.</p>
<p><a href="https://github.com/switchfly/ember-test-helpers">ember-test-helpers</a>
will provide an <code>isolatedApplicationInstance</code> method instead of an
<code>isolatedContainer</code> for unit testing. A mechanism will be developed to specify
which initializers should be engaged in the initialization of this instance.
In this way, we can avoid duplication of registration logic, as is currently
done in a most un-DRY manner in the <a href="https://github.com/switchfly/ember-test-helpers/blob/master/lib/ember-test-helpers/isolated-container.js#L56-L79">isolatedContainer</a>.</p>
<a class="header" href="0046-registry-reform.html#drawbacks" id="drawbacks"><h1>Drawbacks</h1></a>
<p>This refactor will require maintaining backwards compatibility and
deprecation warnings until Ember 2.0. This will temporarily increase
internal code complexity and file sizes.</p>
<a class="header" href="0046-registry-reform.html#alternatives" id="alternatives"><h1>Alternatives</h1></a>
<p>The obvious alternative is to make <code>Container</code> and <code>Registry</code> fully public
and documented. An application's registry would be available as a <code>registry</code>
property. An application instance's container would remain available as
<code>container</code>.</p>
<p>We could still pass an <code>Application</code> into application initializers
and an <code>ApplicationInstance</code> into application instance initializers.</p>
<p>If this alternative is taken, I would suggest that <code>Application</code> should
deprecate <code>register</code> and <code>inject</code> in favor of calling the equivalents on its
public <code>registry</code>.</p>
<p>Regardless of which alternative is chosen, we should ensure that the public
aspects of container and registry usage are well documented.</p>
<a class="header" href="0046-registry-reform.html#unresolved-questions" id="unresolved-questions"><h1>Unresolved questions</h1></a>
<ul>
<li>
<p>Are the public methods listed above sufficient or should any others be
exposed?</p>
</li>
<li>
<p>What mechanism should be used to engage initializers in unit and
integration tests? Should test modules simply have an <code>initializers</code> array,
similar to the current <code>needs</code> array?</p>
</li>
<li>
<p>Given the semi-private nature of containers and registries, we may not need
to worry about semver for deprecations. However, we should be good citizens
and properly deprecate as much as possible. Some real world use cases in
initializers will no doubt be a surprise, so we need to tread carefully.</p>
</li>
</ul>

                </div>

                <!-- Mobile navigation buttons -->
                
                    <a rel="prev" href="0046-cli-improved-release-process.html" class="mobile-nav-chapters previous">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="0050-cli-production-code-stripping.html" class="mobile-nav-chapters next">
                        <i class="fa fa-angle-right"></i>
                    </a>
                

            </div>

            
                <a href="0046-cli-improved-release-process.html" class="nav-chapters previous" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-left"></i>
                </a>
            

            
                <a href="0050-cli-production-code-stripping.html" class="nav-chapters next" title="You can navigate through the chapters using the arrow keys">
                    <i class="fa fa-angle-right"></i>
                </a>
            

        </div>


        <!-- Local fallback for Font Awesome -->
        <script>
            if ($(".fa").css("font-family") !== "FontAwesome") {
                $('<link rel="stylesheet" type="text/css" href="_FontAwesome/css/font-awesome.css">').prependTo('head');
            }
        </script>

        <!-- Livereload script (if served using the cli tool) -->
        

        

        

        

        <script src="highlight.js"></script>
        <script src="book.js"></script>
    </body>
</html>
